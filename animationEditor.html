<!DOCTYPE html>
<html>
<head>
    <title>Terrain</title>
    <script src="js/lib/jquery-1.11.2.min.js"></script>

    <script src="js/spqr.js"></script>
    <script src="js/context.js"></script>
    <script src="js/basicTypes.js"></script>
    <script src="js/state.js"></script>
    <script src="js/engine.js"></script>
    <script src="js/resources.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/terrain.js"></script>
    <script src="js/render.js"></script>
    <script src="js/inputManager.js"></script>
    <script src="js/eventsManager.js"></script>

    <script src="js/aragorn.js"></script>

    <script type="text/javascript">

        function init()
        {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            var resources = new spqr.ResourceManager();
            var renderer = new spqr.RenderManager(context, canvas.width, canvas.height);
            var engine = new spqr.Engine();

            spqr.Context.resources = resources;
            spqr.Context.renderer = renderer;
            spqr.Context.engine = engine;
            spqr.Context.tileWidth = 50;
            spqr.Context.tileHeight = 50;
            spqr.Context.tileAltitude = 50;

            var td = {
                tiles:
                        [
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1],
                            [1, 1, 1, 1, 1, 1, 1, 1]
                        ],
                heightMap:
                        [
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 0, 0, 0, 0, 0, 0]
                        ],
                tileTypes:
                {
                    "1": {color: [0, 0, 0, 0]}
                },
                tileWidth: spqr.Context.tileWidth,
                tileHeight: spqr.Context.tileHeight
            };

            run(td, canvas.width, canvas.height);
        }

        function customHeart(callback)
        {
            window.heartBeat = callback;
        }

        function run(td, viewportWidth, viewportHeight)
        {
            var scene = new spqr.Scene.Manager();
            scene.addTerrain("main", td);

            var fpsNode = document.getElementById("FPS");
            scene.setAction("fps.updated", function()
            {
                fpsNode.innerText = "FPS: " + spqr.Context.engine.currentFPS;
            });

            var camera = new spqr.Scene.Camera(viewportWidth, viewportHeight);
            scene.setActiveCamera(camera);

            spqr.Context.engine.setActiveScene(scene);
            spqr.Context.engine.run();
        }
    </script>
</head>
<body onload="init()">
<canvas id="canvas" width="800" height="400" style="border: solid 1px gray"></canvas>
<div id="FPS"></div>
</body>
</html>